<!--
    @Description:
    @Author: lishuangling
    @Date: 2022/6/22 10:35
 -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>登录界面制作</title>
    <link rel="stylesheet" href="../public/bootstrap-3.4.1-dist/css/bootstrap.css">
    <style>
        #log-in {
            background-color: wheat;
            margin: 10px auto;
            padding: 30px;
            text-align: center;
        }

        #register {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;

        }

        #register button {
            margin: 0;
            width: 49%;

        }

        .username-info, .password-info {
            display: none;
            color: red;
            font-size: 12px;
            text-align: left;
        }


    </style>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-md-6 col-sm-8 col-xs-8 col-md-offset-3 col-sm-offset-2 col-xs-offset-2">
            <form action="#" id="log-in">
                <div class="h2">欢迎使用xxx系统</div>
                <div class="form-group">
                    <!--使用autofocus自动获取焦点-->
                    <input type="text" class="form-control" placeholder="账号" id="username" value="" autofocus>
                    <p class="username-info">⚠请输入正确的账号</p>
                </div>
                <div class="from-group">
                    <input type="password" class="form-control" placeholder="密码" id="password" value="">
                    <p class="password-info">⚠请输入正确的密码</p>
                </div>
                <div class="checkbox">
                    <label for="remember">
                        <input type="checkbox" id="remember">记住密码
                    </label>
                </div>
                <button type="button" class="btn btn-primary btn-block" id="login">登录</button>
                <div id="register">
                    <button class="btn btn-default " type="button">注册</button>
                    <button id="forget" class="btn btn-default" type="button">忘记密码</button>
                </div>
            </form>

        </div>
    </div>
</div>

</div>
<script src="./js/mock.js"></script>
<script src="./js/jquery-3.5.1.js"></script>
<script>

    // TODO:页面加载时，判断localstorage中rememberMe是否存在，如果存在，将其中的username和password填入input

    let users={
            '111111':'222222',
            '222222':'222222',
            '333333':'222222',
            '444444':'222222',
            '555555':'222222',
            '666666':'222222',
        }

    Mock.mock("/login", "post", function (data){
        let params = parseParam(data.body)
        if (checkUserPasswd(params.username,params.password)){
            return {
                code: 0,
                msg: "login success"
            }
        }
        return {
            code: 0,
            msg: "login failed"
        }
    })

    function checkUserPasswd(username,password){
        return !(!users[username] || users[username] !== password)
    }

    function parseParam(params) {
        const newParams = params.split("&");
        const urlObj = new Object();
        for(let i = 0; i < newParams.length; i++) {
            const newArray = newParams[i].split('=');
            urlObj[newArray[0]] = newArray[1]
        }
        return urlObj;
    }

    let username = document.getElementById('username'),
        password = document.getElementById('password'),
        usernameInfo = document.querySelector('.username-info'),
        passwordInfo = document.querySelector('.password-info'),
        login = document.querySelector('#login');
        // TODO:获取rememberMe checkbox
    username.addEventListener('input', function () {
        if (username.value === "" || username.value.trim().length < 6) {
            usernameInfo.style.display='block'
        }else{
            usernameInfo.style.display='none'
        }
    });
    password.addEventListener('input', function () {
        if (password.value === "" || password.value.trim().length < 6) {
            passwordInfo.style.display='block'
        }else{
            passwordInfo.style.display='none'
        }

    });
    password.addEventListener('change', function () {
        // if (password.value===""||password.value)
        // console.log(1)
    });
    login.addEventListener('click',function (){

        // TODO: 提交数据之前检查合法性
        let data = {
            username:username.value,
            password:password.value
        }
        $.post("/login",data,function (result) {
            console.log(result)
            if(result.code===0){
                // TODO:将用户信息写入localstorage,user
                // TODO:如果rememberMe勾选了，那么将用户名密码存入localstorage,rememberMe
                // TODO:如果rememberMe没勾选了，那么localstorage中的rememberMe删掉
                // TODO:跳转页面
                return
            }
            // TODO:提示错误
        })
    });

    // TODO:实现以下方法替代原代码
    function checkUsername(){

    }
    function checkPassword(){
        // TODO:增加正则判断
    }

</script>
</body>
</html>